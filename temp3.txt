    def visitMethodDefinition(self, ctx: ChronoParser.MethodDefinitionContext):
        self._in_class_method = True
        func_name = ctx.name.text
        params_code = self.visit(ctx.parameters()) if ctx.parameters() else ""

        statements = self._safe_iterate_statements(ctx.statement())
        body_code = "".join(self.visit(s) for s in statements)
        print("method body code:", body_code)
        # [修复] 从父级注入的属性中读取修饰符
        is_static = getattr(ctx, '_chrono_static', False)
        access = getattr(ctx, '_chrono_access', 'private')  # 默认为 private

        # --- (签名逻辑...) ---
        if ctx.returnType:
            return_type = ctx.returnType.text
            if return_type in ("i32", "i64", "int", "bool"):
                cpp_return_type = self._chrono_to_cpp_type(return_type)
            else:
                cpp_return_type = f"{self._chrono_to_cpp_type(return_type)}*"
            cpp_func_name = func_name
        else:
            cpp_return_type = "void"
            if func_name == "init":
                cpp_return_type = ""
                cpp_func_name = self._current_class_name
            else:
                cpp_func_name = func_name
        # --- (签名逻辑结束) ---

        static_prefix = "static " if is_static else ""

        func_def_code = (
            f"\n{INDENT}{static_prefix}{cpp_return_type} {cpp_func_name}({params_code}) {{\n"
            f"{body_code}"
            f"{INDENT}// --- Method End ---\n"
            f"{INDENT}}}\n"
        )

        self._class_sections[access] += func_def_code
        self._in_class_method = False
        return ""