    def visitMethodDefinition(self, ctx: ChronoParser.MethodDefinitionContext):
        self._in_class_method = True
        self._enter_scope()  # <-- [新增]

        # [新增] 注册 'this'
        self._add_variable("this", {
            "cpp_name": "this",
            "accessor": "->",
            "cpp_type": f"{self._current_class_name}*"
        })

        func_name = ctx.name.text
        params_code = self.visit(ctx.parameters()) if ctx.parameters() else ""

        statements = self._safe_iterate_statements(ctx.statement())
        body_code = "".join(self.visit(s) for s in statements)

        is_static = getattr(ctx, '_chrono_static', False)
        access = getattr(ctx, '_chrono_access', 'private')

        if ctx.returnType:
            return_type = ctx.returnType.text
            if return_type in ("i32", "i64", "int", "bool"):
                cpp_return_type = self._chrono_to_cpp_type(return_type)
            else:
                cpp_return_type = f"{self._chrono_to_cpp_type(return_type)}*"
            cpp_func_name = func_name
        else:
            cpp_return_type = "void"
            cpp_func_name = func_name

        static_prefix = "static " if is_static else ""

        func_def_code = (
            f"\n{INDENT}{static_prefix}{cpp_return_type} {cpp_func_name}({params_code}) {{\n"
            f"{body_code}"
            f"{INDENT}// --- Method End ---\n"
            f"{INDENT}}}\n"
        )

        self._class_sections[access] += func_def_code

        self._exit_scope()  # <-- [新增]
        self._in_class_method = False
        return ""

        # [ 替换 ] visitInitDefinition

        # [ 替换 ] visitDeinitBlock

        # [ 替换 ] visitFunctionDefinition

        # [ 替换 ] visitIfStatement

        # [ 替换 ] visitWhileStatement
