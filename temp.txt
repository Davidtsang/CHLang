# [ 替换 ] visitMethodDefinition
    def visitMethodDefinition(self, ctx: ChronoParser.MethodDefinitionContext):
        self._in_class_method = True
        self._enter_scope()

        self._add_variable("this", {
            "cpp_name": "this",
            "accessor": "->",
            "cpp_type": f"{self._current_class_name}*"
        })

        func_name = ctx.name.text
        params_code = self.visit(ctx.parameters()) if ctx.parameters() else ""

        statements = self._safe_iterate_statements(ctx.statement())
        body_code = "".join(self.visit(s) for s in statements)

        is_static = getattr(ctx, '_chrono_static', False)
        access = getattr(ctx, '_chrono_access', 'private')

        if ctx.returnType:
            # [ [ 关键修复 ] ]
            # 1. 获取带 $ 的原始文本 (例如 "$Int")
            return_type_raw = ctx.returnType.text
            # 2. 剥离 $ (变为 "Int")
            return_type_stripped = return_type_raw.lstrip('$')
            # 3. 翻译类型 (变为 "ChronoInt")
            return_type_cpp = self._chrono_to_cpp_type(return_type_stripped)
            # [ [ 修复结束 ] ]
            
            if return_type_cpp in ("int32_t", "int64_t", "bool"):
                cpp_return_type = return_type_cpp
            else:
                cpp_return_type = f"{return_type_cpp}*" # 变为 "ChronoInt*"
            cpp_func_name = func_name
        else:
            cpp_return_type = "void"
            cpp_func_name = func_name

        static_prefix = "static " if is_static else ""

        func_def_code = (
            f"\n{INDENT}{static_prefix}{cpp_return_type} {cpp_func_name}({params_code}) {{\n"
            f"{body_code}"
            f"{INDENT}// --- Method End ---\n"
            f"{INDENT}}}\n"
        )

        self._class_sections[access] += func_def_code

        self._exit_scope()
        self._in_class_method = False
        return ""